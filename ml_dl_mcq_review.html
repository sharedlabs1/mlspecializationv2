<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ML/DL MCQ Questions Review - Question Review</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px 20px;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .controls label {
            font-weight: bold;
            margin-right: 10px;
        }

        .controls select, .controls input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .controls select:focus, .controls input:focus {
            outline: none;
            border-color: #667eea;
        }

        .stats {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .question-card {
            background: white;
            margin-bottom: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.2s ease;
        }

        .question-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .question-header {
            background: #667eea;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .question-number {
            font-weight: bold;
            font-size: 1.1em;
        }

        .question-topic {
            background: #764ba2;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .question-set {
            background: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }

        .question-content {
            padding: 20px;
        }

        .scenario {
            background: #f8f9fa;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
            font-style: italic;
        }

        .question-text {
            font-size: 1.1em;
            margin-bottom: 20px;
            line-height: 1.8;
            color: #2c3e50;
            font-weight: 500;
        }

        .options-container {
            display: grid;
            gap: 12px;
        }

        .option {
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
        }

        .option.correct {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }

        .option-label {
            font-weight: bold;
            margin-right: 12px;
            min-width: 25px;
            color: #667eea;
        }

        .option.correct .option-label {
            color: #155724;
        }

        .option-text {
            flex: 1;
        }

        .correct-indicator {
            margin-left: auto;
            color: #28a745;
            font-weight: bold;
        }

        .explanation {
            margin-top: 15px;
            padding: 15px;
            background: #e8f5e8;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
        }

        .explanation-title {
            font-weight: bold;
            color: #155724;
            margin-bottom: 8px;
        }

        .search-highlight {
            background-color: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .no-results {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 1.2em;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #666;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .controls > div {
                display: flex;
                flex-direction: column;
                gap: 5px;
            }

            .question-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .stats {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .pagination button {
            padding: 10px 15px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .pagination button:hover:not(:disabled) {
            background: #667eea;
            color: white;
        }

        .pagination button.active {
            background: #764ba2;
            border-color: #764ba2;
            color: white;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-info {
            margin: 0 15px;
            color: #666;
        }

        .comment-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .comment-form h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .comment-form textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
            margin-bottom: 10px;
        }

        .comment-form select {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
        }

        .comment-form button {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .comment-form button:hover {
            background: #218838;
        }

        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .auth-modal {
            background: white;
            padding: 40px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .auth-modal h2 {
            margin-bottom: 20px;
            color: #667eea;
        }

        .auth-modal input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .auth-modal button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
        }

        .auth-modal button:hover {
            background: #5a6fd8;
        }

        .logout-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
        }

        .success-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #28a745;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            z-index: 1001;
            display: none;
        }
    </style>
</head>
<body>
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-modal">
            <h2>🔐 Access Control</h2>
            <p>Please enter your credentials to access the ML/DL MCQ Review System</p>
            <input type="text" id="username" placeholder="Username" />
            <input type="password" id="password" placeholder="Password" />
            <button onclick="authenticate()">Login</button>
            <div id="authError" style="color: red; margin-top: 10px; display: none;"></div>
        </div>
    </div>

    <div class="success-message" id="successMessage"></div>

    <div class="container">
                <div class="header">
            <h1>ML/DL MCQ Questions Review</h1>
            <p>Review and manage ML/DL assessment questions with comprehensive analytics</p>
            <div id="loadingStatus" style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                Loading questions from CSV files...
            </div>
        </div>

        <div class="stats" id="stats">
            <div class="stat-item">
                <div class="stat-number" id="totalQuestions">600</div>
                <div class="stat-label">Total Questions</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="filteredQuestions">600</div>
                <div class="stat-label">Displayed Questions</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="totalTopics">25+</div>
                <div class="stat-label">ML/DL Topics Covered</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">3</div>
                <div class="stat-label">Question Sets</div>
            </div>
        </div>

        <div class="controls">
            <div>
                <label for="topicFilter">Filter by Topic:</label>
                <select id="topicFilter">
                    <option value="">All Topics</option>
                </select>
            </div>
            <div>
                <label for="setFilter">Filter by Set:</label>
                <select id="setFilter">
                    <option value="">All Sets</option>
                    <option value="Set 1">Set 1 - ML Fundamentals & Neural Networks (200 questions)</option>
                    <option value="Set 2">Set 2 - NLP, Transformers & LLMs (200 questions)</option>
                    <option value="Set 3">Set 3 - RAG, MCP & Advanced Deployment (200 questions)</option>
                </select>
            </div>
            <div>
                <label for="searchInput">Search Questions:</label>
                <input type="text" id="searchInput" placeholder="Search by question text, options, or topic...">
            </div>
            <div>
                <label for="questionsPerPage">Questions per page:</label>
                <select id="questionsPerPage">
                    <option value="10">10</option>
                    <option value="25" selected>25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                    <option value="all">All</option>
                </select>
            </div>
        </div>

        <div class="pagination" id="topPagination"></div>

        <div id="questionsContainer">
            <div class="loading">Loading questions...</div>
        </div>

        <div class="pagination" id="bottomPagination"></div>
    </div>

    <script>
        let allQuestions = [];
        let filteredQuestions = [];
        let currentPage = 1;
        let questionsPerPage = 25;

        // Authentication system
        function authenticate() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const authError = document.getElementById('authError');

            // Check credentials
            const validCredentials = [
                { username: 'admin', password: 'X9085565r@', role: 'admin' },
                { username: 'reviewer1', password: 'MLReview2024!', role: 'reviewer' },
                { username: 'reviewer2', password: 'DeepLearning123', role: 'reviewer' },
                { username: 'guest', password: 'MLGuest2024', role: 'guest' }
            ];

            const user = validCredentials.find(u => u.username === username && u.password === password);

            if (user) {
                sessionStorage.setItem('ml_dl_username', username);
                sessionStorage.setItem('ml_dl_user_role', user.role);
                sessionStorage.setItem('ml_dl_login_time', new Date().toISOString());
                
                document.getElementById('authOverlay').style.display = 'none';
                document.querySelector('.container').style.filter = 'none';
                document.querySelector('.container').style.pointerEvents = 'auto';
                
                addLogoutButton(username);
                initializeApp();
            } else {
                authError.style.display = 'block';
                authError.textContent = 'Invalid credentials. Please try again.';
            }
        }

        function checkAuthentication() {
            const username = sessionStorage.getItem('ml_dl_username');
            const loginTime = sessionStorage.getItem('ml_dl_login_time');
            
            if (!username || !loginTime) {
                return false;
            }
            
            // Check if session is expired (4 hours)
            const now = new Date();
            const login = new Date(loginTime);
            const diffHours = (now - login) / (1000 * 60 * 60);
            
            if (diffHours > 4) {
                sessionStorage.clear();
                return false;
            }
            
            return true;
        }

        function logout() {
            sessionStorage.clear();
            location.reload();
        }

        function addLogoutButton(username) {
            const logoutContainer = document.createElement('div');
            logoutContainer.className = 'logout-container';
            logoutContainer.innerHTML = `
                <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <span style="margin-right: 10px;">Welcome, ${username}</span>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            `;
            document.body.appendChild(logoutContainer);
        }

        // Initialize the application
        async function initializeApp() {
            try {
                // Initialize allQuestions array
                allQuestions = [];
                
                // Load questions from all three CSV files
                const csvFiles = [
                    { file: './ml_dl_mcq_set1_200_questions.csv', set: 'Set 1' },
                    { file: './ml_dl_mcq_set2_200_questions.csv', set: 'Set 2' },
                    { file: './ml_dl_mcq_set3_200_questions.csv', set: 'Set 3' }
                ];
                
                for (const csvInfo of csvFiles) {
                    try {
                        console.log(`Loading ${csvInfo.file}...`);
                        const response = await fetch(csvInfo.file);
                        
                        if (response.ok) {
                            const csvText = await response.text();
                            console.log(`CSV content length for ${csvInfo.file}: ${csvText.length} characters`);
                            
                            const questions = parseCSV(csvText);
                            console.log(`Parsed ${questions.length} questions from ${csvInfo.file}`);
                            
                            // Add set information to each question
                            const questionsWithSet = questions.map(q => ({...q, set: csvInfo.set}));
                            allQuestions = allQuestions.concat(questionsWithSet);
                        } else {
                            console.warn(`Failed to load ${csvInfo.file}: ${response.status} ${response.statusText}`);
                        }
                    } catch (error) {
                        console.error(`Error loading ${csvInfo.file}:`, error);
                    }
                }

                console.log(`Total questions loaded from CSV files: ${allQuestions.length}`);

                // Update loading status
                const loadingStatus = document.getElementById('loadingStatus');
                if (allQuestions.length > 0) {
                    loadingStatus.innerHTML = `✅ Successfully loaded ${allQuestions.length} questions from CSV files`;
                    loadingStatus.style.color = '#28a745';
                } else {
                    loadingStatus.innerHTML = `⚠️ CSV files not found, using sample data`;
                    loadingStatus.style.color = '#ffc107';
                }

                // If CSV files are not available or no questions loaded, use sample data
                if (allQuestions.length === 0) {
                    console.warn('No questions loaded from CSV files, using sample data');
                    allQuestions = generateSampleQuestions();
                }

                filteredQuestions = [...allQuestions];
                populateTopicFilter();
                updateStats();
                renderQuestions();
                setupEventListeners();
                
            } catch (error) {
                console.error('Error in initializeApp:', error);
                allQuestions = generateSampleQuestions();
                filteredQuestions = [...allQuestions];
                populateTopicFilter();
                updateStats();
                renderQuestions();
                setupEventListeners();
            }
        }

        // Function to parse CSV data with improved error handling
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const questions = [];
            
            // Skip header row and process data rows
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue; // Skip empty lines
                
                try {
                    const values = parseCSVLine(line);
                    if (values.length >= 9) { // Ensure we have all required columns
                        questions.push({
                            question: cleanCSVField(values[0]),
                            scenario: cleanCSVField(values[1]),
                            optionA: cleanCSVField(values[2]),
                            optionB: cleanCSVField(values[3]),
                            optionC: cleanCSVField(values[4]),
                            optionD: cleanCSVField(values[5]),
                            correctAnswer: cleanCSVField(values[6]),
                            explanation: cleanCSVField(values[7]),
                            topic: cleanCSVField(values[8])
                        });
                    }
                } catch (error) {
                    console.warn(`Error parsing line ${i}: ${error.message}`);
                }
            }
            
            return questions;
        }

        // Function to parse CSV line handling quoted content properly
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            let i = 0;
            
            while (i < line.length) {
                const char = line[i];
                const nextChar = line[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        // Escaped quote ("")
                        current += '"';
                        i += 2;
                    } else {
                        // Toggle quote state
                        inQuotes = !inQuotes;
                        i++;
                    }
                } else if (char === ',' && !inQuotes) {
                    // Field separator
                    result.push(current);
                    current = '';
                    i++;
                } else {
                    current += char;
                    i++;
                }
            }
            
            // Add the last field
            result.push(current);
            return result;
        }

        // Clean CSV field content
        function cleanCSVField(field) {
            if (!field) return '';
            return field.replace(/^"|"$/g, '').replace(/""/g, '"').trim();
        }

        // Generate sample questions for demonstration
        function generateSampleQuestions() {
            const topics = [
                "ML Fundamentals", "Neural Networks", "CNN Architecture", "RNN/LSTM", "Model Evaluation",
                "NLP Basics", "Transformers", "BERT/GPT", "Word Embeddings", "Language Models",
                "RAG Systems", "Vector Databases", "MCP Protocol", "LLM Deployment", "Production ML"
            ];
            
            const sampleQuestions = [];
            
            for (let i = 1; i <= 600; i++) {
                let setNumber;
                if (i <= 200) setNumber = 'Set 1';
                else if (i <= 400) setNumber = 'Set 2';
                else setNumber = 'Set 3';
                
                const topicIndex = (i - 1) % topics.length;
                
                sampleQuestions.push({
                    question: `Sample ML/DL question ${i}: A data scientist needs to implement machine learning solutions for their business problem. What is the best approach for this scenario?`,
                    scenario: `Business scenario for question ${i}: Company needs to optimize their ML pipeline for better performance and accuracy.`,
                    optionA: `Option A for question ${i}: Use traditional ML algorithms`,
                    optionB: `Option B for question ${i}: Implement deep learning models`,
                    optionC: `Option C for question ${i}: Apply ensemble methods`,
                    optionD: `Option D for question ${i}: Use transfer learning approach`,
                    correctAnswer: ['A', 'B', 'C', 'D'][i % 4],
                    explanation: `Explanation for question ${i}: This approach is optimal because it addresses the specific requirements of the use case while maintaining computational efficiency.`,
                    topic: topics[topicIndex],
                    set: setNumber
                });
            }
            
            return sampleQuestions;
        }

        // Populate topic filter dropdown
        function populateTopicFilter() {
            const topics = [...new Set(allQuestions.map(q => q.topic))].sort();
            const topicFilter = document.getElementById('topicFilter');
            
            topicFilter.innerHTML = '<option value="">All Topics</option>';
            topics.forEach(topic => {
                const option = document.createElement('option');
                option.value = topic;
                option.textContent = topic;
                topicFilter.appendChild(option);
            });
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalQuestions').textContent = allQuestions.length;
            document.getElementById('filteredQuestions').textContent = filteredQuestions.length;
            document.getElementById('totalTopics').textContent = new Set(allQuestions.map(q => q.topic)).size;
        }

        // Filter questions
        function filterQuestions() {
            const topicFilter = document.getElementById('topicFilter').value;
            const setFilter = document.getElementById('setFilter').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            filteredQuestions = allQuestions.filter(question => {
                const matchesTopic = !topicFilter || question.topic === topicFilter;
                const matchesSet = !setFilter || question.set === setFilter;
                const matchesSearch = !searchTerm || 
                    question.question.toLowerCase().includes(searchTerm) ||
                    question.scenario.toLowerCase().includes(searchTerm) ||
                    question.optionA.toLowerCase().includes(searchTerm) ||
                    question.optionB.toLowerCase().includes(searchTerm) ||
                    question.optionC.toLowerCase().includes(searchTerm) ||
                    question.optionD.toLowerCase().includes(searchTerm) ||
                    question.explanation.toLowerCase().includes(searchTerm) ||
                    question.topic.toLowerCase().includes(searchTerm);

                return matchesTopic && matchesSet && matchesSearch;
            });

            currentPage = 1;
            updateStats();
            renderQuestions();
        }

        // Render questions
        function renderQuestions() {
            const container = document.getElementById('questionsContainer');
            const perPage = document.getElementById('questionsPerPage').value;
            
            if (filteredQuestions.length === 0) {
                container.innerHTML = '<div class="no-results">No questions found matching your criteria.</div>';
                updatePagination();
                return;
            }

            let questionsToShow;
            if (perPage === 'all') {
                questionsToShow = filteredQuestions;
                questionsPerPage = filteredQuestions.length;
            } else {
                questionsPerPage = parseInt(perPage);
                const startIndex = (currentPage - 1) * questionsPerPage;
                const endIndex = startIndex + questionsPerPage;
                questionsToShow = filteredQuestions.slice(startIndex, endIndex);
            }

            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            container.innerHTML = questionsToShow.map((question, index) => {
                const globalIndex = perPage === 'all' ? index + 1 : (currentPage - 1) * questionsPerPage + index + 1;
                const originalIndex = allQuestions.indexOf(question) + 1;
                
                return `
                    <div class="question-card">
                        <div class="question-header">
                            <span class="question-number">Question ${globalIndex} (Original #${originalIndex})</span>
                            <div style="display: flex; gap: 10px; margin-left: auto;">
                                <span class="question-set">${question.set}</span>
                                <span class="question-topic">${question.topic}</span>
                            </div>
                        </div>
                        <div class="question-content">
                            ${question.scenario ? `<div class="scenario"><strong>Scenario:</strong> ${highlightSearchTerm(question.scenario, searchTerm)}</div>` : ''}
                            <div class="question-text">${highlightSearchTerm(question.question, searchTerm)}</div>
                            <div class="options-container">
                                <div class="option ${question.correctAnswer === 'A' ? 'correct' : ''}">
                                    <span class="option-label">A.</span>
                                    <span class="option-text">${highlightSearchTerm(question.optionA, searchTerm)}</span>
                                    ${question.correctAnswer === 'A' ? '<span class="correct-indicator">✓ Correct</span>' : ''}
                                </div>
                                <div class="option ${question.correctAnswer === 'B' ? 'correct' : ''}">
                                    <span class="option-label">B.</span>
                                    <span class="option-text">${highlightSearchTerm(question.optionB, searchTerm)}</span>
                                    ${question.correctAnswer === 'B' ? '<span class="correct-indicator">✓ Correct</span>' : ''}
                                </div>
                                <div class="option ${question.correctAnswer === 'C' ? 'correct' : ''}">
                                    <span class="option-label">C.</span>
                                    <span class="option-text">${highlightSearchTerm(question.optionC, searchTerm)}</span>
                                    ${question.correctAnswer === 'C' ? '<span class="correct-indicator">✓ Correct</span>' : ''}
                                </div>
                                <div class="option ${question.correctAnswer === 'D' ? 'correct' : ''}">
                                    <span class="option-label">D.</span>
                                    <span class="option-text">${highlightSearchTerm(question.optionD, searchTerm)}</span>
                                    ${question.correctAnswer === 'D' ? '<span class="correct-indicator">✓ Correct</span>' : ''}
                                </div>
                            </div>
                            ${question.explanation ? `
                                <div class="explanation">
                                    <div class="explanation-title">💡 Explanation:</div>
                                    <div>${highlightSearchTerm(question.explanation, searchTerm)}</div>
                                </div>
                            ` : ''}
                            <div class="comment-section">
                                <div class="comment-form">
                                    <h4>💬 Add Review Comment</h4>
                                    <textarea 
                                        id="comment-${originalIndex}" 
                                        placeholder="Share your feedback about this question (quality, clarity, difficulty, etc.)"
                                    ></textarea>
                                    <div style="display: flex; gap: 10px; align-items: center;">
                                        <select id="rating-${originalIndex}">
                                            <option value="">Rate this question</option>
                                            <option value="excellent">⭐⭐⭐⭐⭐ Excellent</option>
                                            <option value="good">⭐⭐⭐⭐ Good</option>
                                            <option value="average">⭐⭐⭐ Average</option>
                                            <option value="poor">⭐⭐ Poor</option>
                                            <option value="very-poor">⭐ Very Poor</option>
                                        </select>
                                        <button 
                                            onclick="submitComment('mcq', ${originalIndex}, '${question.set}', '${question.topic.replace(/'/g, "\\'")}', '${question.question.substring(0, 50).replace(/'/g, "\\'")}...')"
                                        >
                                            Submit Comment
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            updatePagination();
        }

        // Highlight search terms
        function highlightSearchTerm(text, searchTerm) {
            if (!searchTerm) return text;
            
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        }

        // Update pagination
        function updatePagination() {
            const perPage = document.getElementById('questionsPerPage').value;
            const topPagination = document.getElementById('topPagination');
            const bottomPagination = document.getElementById('bottomPagination');
            
            if (perPage === 'all' || filteredQuestions.length <= questionsPerPage) {
                topPagination.innerHTML = '';
                bottomPagination.innerHTML = '';
                return;
            }

            const totalPages = Math.ceil(filteredQuestions.length / questionsPerPage);
            const paginationHTML = createPaginationHTML(totalPages);
            
            topPagination.innerHTML = paginationHTML;
            bottomPagination.innerHTML = paginationHTML;
        }

        // Create pagination HTML
        function createPaginationHTML(totalPages) {
            let html = '';
            
            // Previous button
            html += `<button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>Previous</button>`;
            
            // Page numbers
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            if (startPage > 1) {
                html += `<button onclick="changePage(1)">1</button>`;
                if (startPage > 2) html += '<span>...</span>';
            }
            
            for (let i = startPage; i <= endPage; i++) {
                html += `<button onclick="changePage(${i})" ${i === currentPage ? 'class="active"' : ''}>${i}</button>`;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += '<span>...</span>';
                html += `<button onclick="changePage(${totalPages})">${totalPages}</button>`;
            }
            
            // Next button
            html += `<button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Next</button>`;
            
            // Page info
            html += `<span class="pagination-info">Page ${currentPage} of ${totalPages}</span>`;
            
            return html;
        }

        // Change page
        function changePage(page) {
            const totalPages = Math.ceil(filteredQuestions.length / questionsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderQuestions();
                window.scrollTo(0, 0);
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('topicFilter').addEventListener('change', filterQuestions);
            document.getElementById('setFilter').addEventListener('change', filterQuestions);
            document.getElementById('searchInput').addEventListener('input', debounce(filterQuestions, 300));
            document.getElementById('questionsPerPage').addEventListener('change', () => {
                currentPage = 1;
                renderQuestions();
            });
        }

        // Debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Comment System Functions
        function submitComment(type, itemId, category, topic, title) {
            const commentText = document.getElementById(`comment-${itemId}`).value.trim();
            const rating = document.getElementById(`rating-${itemId}`).value;
            const username = sessionStorage.getItem('ml_dl_username');
            
            if (!commentText) {
                alert('Please enter a comment before submitting.');
                return;
            }
            
            const comment = {
                timestamp: new Date().toISOString(),
                user: username,
                type: type, // 'mcq', 'assignment', 'capstone'
                itemId: itemId,
                category: category,
                topic: topic,
                title: title,
                comment: commentText,
                rating: rating,
                id: Date.now() + Math.random()
            };
            
            // Save to localStorage
            saveComment(comment);
            
            // Clear form
            document.getElementById(`comment-${itemId}`).value = '';
            document.getElementById(`rating-${itemId}`).value = '';
            
            // Show success message
            showSuccessMessage('Comment submitted successfully!');
        }

        function saveComment(comment) {
            const existingComments = JSON.parse(localStorage.getItem('ml_dl_review_comments') || '[]');
            existingComments.push(comment);
            localStorage.setItem('ml_dl_review_comments', JSON.stringify(existingComments));
            
            // Also save as CSV format for easy export
            const csvData = convertToCSV(existingComments);
            localStorage.setItem('ml_dl_review_comments_csv', csvData);
        }

        function convertToCSV(comments) {
            const headers = ['Timestamp', 'User', 'Type', 'ItemID', 'Category', 'Topic', 'Title', 'Comment', 'Rating'];
            const csvContent = [
                headers.join(','),
                ...comments.map(comment => [
                    comment.timestamp,
                    comment.user,
                    comment.type,
                    comment.itemId,
                    comment.category,
                    comment.topic,
                    comment.title,
                    `"${comment.comment.replace(/"/g, '""')}"`,
                    comment.rating
                ].join(','))
            ].join('\n');
            
            return csvContent;
        }

        function showSuccessMessage(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }

        // Initialize the application when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication first
            if (!checkAuthentication()) {
                document.querySelector('.container').style.filter = 'blur(5px)';
                document.querySelector('.container').style.pointerEvents = 'none';
                return;
            }
            
            // Add logout button
            const username = sessionStorage.getItem('ml_dl_username');
            addLogoutButton(username);
            
            // Initialize the app
            initializeApp();
        });

        // Handle Enter key in auth form
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.getElementById('authOverlay').style.display !== 'none') {
                authenticate();
            }
        });
    </script>
</body>
</html>